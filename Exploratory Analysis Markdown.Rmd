---
title: "Exploratory Analysis"
author: "Nathan Bush"
date: "2022-11-08"
output:
  html_document: default
  pdf_document: default
---
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(tigris)
library(raster)
library(readxl)
library(sf)
library(tmap)
library(equatiomatic)
```


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
load("~/Documents/GitHub/Data-Analytics-Term-Project/Relevant Files/dataset_final_new.Rdata")
load("~/Documents/GitHub/Data-Analytics-Term-Project/Relevant Files/color.Rdata")
load("~/Documents/GitHub/Data-Analytics-Term-Project/Relevant Files/states.Rdata")
load("~/Documents/GitHub/Data-Analytics-Term-Project/Relevant Files/final_map.Rdata")
load("~/Documents/GitHub/Data-Analytics-Term-Project/Relevant Files/final_dataset.Rdata")
load("~/Documents/GitHub/Data-Analytics-Term-Project/Relevant Files/final_dataset.Rdata")

```

REPORT
  
In this analysis I compare the political leanings of states in the US with the their energy usage statistics and emissions. This is important to understand whether or not political views effect the type of energy states are using. This is important because is can effect and inform policy, show whether or not states are taking advantage of their natural resources, and help usunderstand the dynamics behind energy systems and how politics plays a role in these systems. If we find that conservative leaning states tend to use less renewable energy than their state's natural resources provide, or that liberal states tend to rely excessively on renewable energy when their state is lacking in these resources, then we can assume that more effective policy needs to be implemented to incentivize states to act more efficiently with their energy generation.
  
The data I use in this analysis come from three sources. My first dataset is energy usage statistics on a wide variety of metrics in each state. This is taken from the US Energy Information Administration. Key variables here are the percentages of petroleum, natural gas, coal, and renewable energy as a percentage of the total energy use in the state. My second and third datasets are county voting data on the 2020 presidential election taken from the MIT Election and Data Science lab and the Harvard Dataverse. The variables here are State, County, Candidate, # of votes in each county, total votes. My third dataset is table that webscraped from Wikipedia showing who each state's governor is and which political party they are associated with. My hypothesis is that a state who voted for a republican in the 2020 election and has a republican governor is more conservative than a state that has a democratic governor but voted republican in the 2020 election. I will be able to test whether or not there is any difference in energy usage based on these observed differences by adding in the governor variable. There is a fourth dataset in the start of my code but that did not end up being used.

Cleaning and merging this data was a timely process. I cleaned the energy data by getting rid of unnecessary rows and columns generated in excel and deleting variables unrelated to my analysis. Some of the data had * for values less than 0.5 which were deemed as statistically equal to 0. I changed these values to 0 and adjusted some names to be easier to work with. I deleted total US observations and the DC observation in addition to transposing key rows and columns to get the tidy in tidy format. I made a few other adjustments that are notated in my code as well. For the presidential data, I filtered out all observations for votes other than those for Joe Biden and Donald Trump. I also needed to summarize all vote types, create a new variable that summarized total votes in across counties within states, and create a dummy variable for party. The governor's data was fairly simple to web scrape and import into r. I deleted a a couple of unnecessary variables and named key variables accordingly. 

I merged the data using state as the unique ID and then got to work creating 3 state political categories. Blue, Red, and Purple, I used dummy variables for governor (1 if republican, 0 if not), for president (1 if republican, 0 if not). I then created a variable for state political category where (Blue = 0 for governor dummy & 0 for president dummy, Red = 1 for governor dummy and 1 for president dummy, Purple = 1 in one dummy, 0 in another). I then created another variable mean renewable energy percentage based on state political category and showed this graphically. The units of analysis in this final merged data set vary between variables and are specific to each respective visualization.

I did employ a few transformations throughout the course the project. These are outlined in each visualization, but are primarily based upon adjusting state energy measurement statistics to account for differing state GDP's and populations. I did not remove any outliers in the raw data.


Visualization 1
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
graph_1_color <- ggplot(data=color, aes(x=state_cat, y=renew,fill=state_cat))+
  geom_bar(stat="identity")+
  scale_fill_manual(values=c("blue",
                             "purple",
                             "red")) + labs(y= "% Renewable Energy" , x = "State Category") + 
  theme(legend.position = "none") + geom_col(colour = "black") +  geom_label(aes(label = renew), vjust = 1.5, colour = "black", fill = "white") +
  ylim(0,33) +labs(title = "Electricity Generation by State Political Category")
graph_1_color
```
Based on the above graph, we can see the percentage of electricity among groups of states that is generated by renewable energy. We observe that purple states (states with governors whose political party does not align with the way the state voted in the 2020 election) actually produce less of their electricity using renewable energy than either blue states (states with a democratic governor who voted for Joe Biden in 2020) or red states (states with a republican governor who voted for Donald Trump in 2020). This is an interesting result. One hypothesis for this could be that purple states are less efficient at passing legislation due to their conflicting political idealogies than either blue or red states. If renewable energy is objectively in the best interest of agents, passing renewable energy legislation would only be held up by one political attempting to spite the other for leverage purposes.


Visualization 2
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
affiliation_map <- tm_shape(final_map)+tm_polygons(col ="state_category", palette = c(Blue = "blue", Red = "red", Purple = "purple"), title = "Political Category") 
affiliation_map

```
This map is showing us the state category of each state in the US by color. We can use this as a reference for our results going forward. 


Visualization 3
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
energy_map = tm_shape(final_map)+tm_polygons(col ="Renewables", palette =c("Greens"), title = "Renewable Energy (%)")
energy_map
```
This map shows the renewable energy percentage by state. Dark states have higher renewable energy percentages. We can see that states west of the Mississippi and concentrated in the northwest and northeast corners of the country seem to have higher percentages of renewable energy production.



Visualization 4
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
dot_plot =  ggplot(dataset_final_new, aes(x = Renewables, y = reorder (state, Renewables), col = state_category, label = state)) +
    geom_point() + scale_color_manual(values=c("blue", "purple", "red")) +
  ylab("State") + xlab("Renewable Energy (% electricity generation)") +
  theme(legend.position = "none")
dot_plot
```
In graph 3, we show the percentage of renewable energy by state. We do not see any noteworthy trends based upon political category. It is worth noting that Vermont, a purple state is ran on 100% renewable energy. Very cool.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
dot_plot_2 = ggplot(dataset_final_new, aes(x = Renewables, y = reorder (state, Renewables))) +
  geom_point(size = 3, aes(colour = state_category)) +
  scale_color_manual(values=c("blue", "purple", "red"), limits = c("Blue","Purple","Red")) +
  facet_grid(state_category ~ ., scales = "free_y", space = "free_y") +
  theme(legend.position = "none") +  
  ylab("State") + xlab("Renewable Energy (% Electricity Generation)")

dot_plot_2

```



Visualization 5
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
graph_5.0 = ggplot(data = final_dataset, aes(x = new_solar, y = avg_temp, col = state_category, label = state, group = state_category)) +
  geom_point() + scale_color_manual(values=c("blue", "purple", "red")) + 
  geom_text(hjust=1, vjust=1.5, size = 3) + 
  ylab("Average Temperature") + 
  xlab("Solar Energy") + geom_smooth(method="lm", se = FALSE)
graph_5.0
```

Above, we create a graph showing solar energy in relation to average temperature. We would expect that states with higher average temperatures employ more solar energy because they have more sunlight. We add a line of best fit to our graph to test whether or not this is the case. We see evidence that blue and red states are employing more solar energy in states with hotter temperatures, while purple states are showing the opposite trend. This MAY lend credence to our initial hypothesis that states with conflicting political interests are less efficient than states with a more uniform political environment. 

Visualization 6
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
graph_6 = ggplot(data = final_dataset, aes(x = Renewables, y = co2_emissions, col = state_category, label = state, group = state_category)) +
  geom_point() + scale_color_manual(values=c("blue", "purple", "red")) + 
  geom_text(hjust=1, vjust=1.5, size = 3) + 
  ylab("CO2 Emissions") + 
  xlab("Renewable Energy %") 
graph_6
```
Yikes, based on this, we see Texas is by far the biggest Co2 emitter in the US, despite producing 25% renewable energy. Let's control for population size and graph again below.

Visualization 7
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
final_dataset = final_dataset |> mutate(co2_pop = co2_emissions/labor_force)

graph_6.0 = ggplot(data = final_dataset, aes(x = Renewables, y = co2_pop, col = state_category, label = state, group = state_category)) +
  geom_point() + scale_color_manual(values=c("blue", "purple", "red")) + 
  geom_text(hjust=1, vjust=1.5, size = 3) + 
  ylab("CO2 Emissions") + 
  xlab("Renewable Energy %") 

graph_6.0
```

Now, we correct for CO2 amounts based on state population, and get a graph showing CO2 emissions per capita. We see that Wyoming, West Virginia, and South Dakota are significantly above the national average. Texas has entered the middle of the pack now that we adjust for state population. Let's remove the three outliers on the upper end of the spectrum and compare trends by state political category. 


Visualization 8
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
graph_6.0.1 = ggplot(data = final_dataset, aes(x = Renewables, y = co2_pop, col = state_category, label = state, group = state_category)) +
  geom_point() + scale_color_manual(values=c("blue", "purple", "red")) + 
  geom_text(hjust=1, vjust=1.5, size = 3) + 
  ylab("CO2 Emissions") + 
  xlab("Renewable Energy %") +ylim(0,25000) +
  geom_smooth(method = "lm", se = FALSE)

graph_6.0.1
```

Now, we see that there is a decreasing trend in Co2 per capita with an increase in renewable energy present within each state political category. however, of the 20 states with Co2 emissions per capita of less than 7500 metric tons, just 3 of the states are "red". 


REGRESSIONS
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
final_dataset$GDP =  as.numeric(final_dataset$GDP)
final_dataset$avg_temp =  as.numeric(final_dataset$avg_temp)
final_dataset$Renewables =  as.numeric(final_dataset$Renewables)
final_dataset$precip =  as.numeric(dataset_final_new$precip)
final_dataset <- rename(final_dataset, rep_gov = "republican governor")
```


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
reg_1 = feols(Renewables ~ avg_temp + GDP + precip, data = final_dataset)
summary(reg_1) |> tidy()
```

```{r}
reg_2 = feols(Renewables ~ avg_temp + GDP + precip + state_category, data = final_dataset)
summary(reg_2)
```

```{r}
reg_3 = feols(Renewables ~ avg_temp + GDP + precip + co2_pop + trump_vote * rep_gov, data = final_dataset)
summary(reg_3)
```

```{r}
reg_4 = feols(co2_pop ~ avg_temp + GDP + precip + Renewables + trump_vote * rep_gov, data = final_dataset)
summary(reg_4)
```

```{r}
etable(reg_1,reg_2, reg_3, reg_4)
```
MOTIVATION

In my econometric analysis, I will be using regression analysis as a first step towards causal inference. I am interested in examining the relationship between a couple of independent variables within my data and my key variable of interest, the amount of renewable energy that each state generates as a percentage of its total electricity generation. 

My first regression equation is: 

Renewable Energy (%) = Bo 



In the above section, I estimate 4 regression equations. 
